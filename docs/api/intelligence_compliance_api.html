<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligence & Compliance Agent API Documentation</title>
    <style>
        /* Professional UI/UX Design - Rule 7 Compliance */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            margin: 5px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #555;
            font-size: 0.9em;
        }

        .nav-tab:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab.active {
            background: #8e44ad;
            color: white;
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #8e44ad;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
        }

        .section h3 {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .icon {
            margin-right: 12px;
            font-size: 1.2em;
        }

        .endpoint-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #9b59b6;
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .method-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8em;
            margin-right: 15px;
            text-transform: uppercase;
        }

        .method-get { background: #d4edda; color: #155724; }
        .method-post { background: #cce5ff; color: #004085; }
        .method-put { background: #fff3cd; color: #856404; }
        .method-delete { background: #f8d7da; color: #721c24; }

        .endpoint-url {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: 600;
        }

        .endpoint-description {
            margin: 15px 0;
            color: #555;
            line-height: 1.6;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #8e44ad;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .copy-button:hover {
            background: #7d3c98;
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .parameter-table th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .parameter-table td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        .parameter-table tr:hover {
            background: #f8f9fa;
        }

        .type-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .required-badge {
            background: #ffebee;
            color: #c62828;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .optional-badge {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .response-example {
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .response-example h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .alert-box {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #0d47a1;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }

        .alert-success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #1b5e20;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-card li {
            padding: 5px 0;
            color: #555;
            position: relative;
            padding-left: 20px;
        }

        .feature-card li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .json-logic-example {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #8e44ad;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .back-to-top:hover {
            background: #7d3c98;
            transform: translateY(-3px);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin: 5px 0;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .endpoint-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .method-badge {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧠 Intelligence & Compliance Agent API</h1>
            <p>Advanced Rule Processing, Jurisdiction Handling & Compliance Logic</p>
            <p><strong>Version:</strong> 4.0 | <strong>Base URL:</strong> http://localhost:8003 | <strong>Last Updated:</strong> <span id="lastUpdated"></span></p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">📋 Overview</button>
            <button class="nav-tab" onclick="showTab('rules')">⚖️ Rule Engine</button>
            <button class="nav-tab" onclick="showTab('jurisdictions')">🌍 Jurisdictions</button>
            <button class="nav-tab" onclick="showTab('overlaps')">🔄 Overlap Resolution</button>
            <button class="nav-tab" onclick="showTab('kafka')">📨 Kafka Integration</button>
            <button class="nav-tab" onclick="showTab('ai')">🤖 AI Processing</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="section">
                <h2><span class="icon">📋</span>API Overview</h2>
                
                <div class="alert-box alert-info">
                    <strong>🧠 Intelligence & Compliance Agent:</strong> This agent processes regulatory obligations into executable JSON-Logic rules, handles multi-jurisdiction compliance, resolves regulatory overlaps, and integrates with AI services for complex reasoning.
                </div>

                <h3>🎯 Core Capabilities</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>⚖️ Rule Compilation</h4>
                        <ul>
                            <li>JSON-Logic rule generation from regulatory text</li>
                            <li>Complex condition-action mapping</li>
                            <li>Rule validation and testing</li>
                            <li>Performance optimization</li>
                            <li>Version control and rollback</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>🌍 Jurisdiction Handling</h4>
                        <ul>
                            <li>Multi-jurisdiction precedence resolution</li>
                            <li>Conflict detection and resolution</li>
                            <li>Jurisdiction-specific rule application</li>
                            <li>Cross-border compliance management</li>
                            <li>Regulatory hierarchy enforcement</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>🔄 Overlap Resolution</h4>
                        <ul>
                            <li>Intelligent regulatory overlap detection</li>
                            <li>Automated rule coalescing</li>
                            <li>Conflict resolution algorithms</li>
                            <li>Redundancy elimination</li>
                            <li>Consistency validation</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>🤖 AI Integration</h4>
                        <ul>
                            <li>LangChain integration for complex reasoning</li>
                            <li>OpenAI GPT for text understanding</li>
                            <li>SpaCy NLP for entity recognition</li>
                            <li>Semantic similarity matching</li>
                            <li>Continuous learning and improvement</li>
                        </ul>
                    </div>
                </div>

                <h3>🔐 Authentication & Security</h3>
                <div class="code-block">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
# API Key Authentication
curl -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     http://localhost:8003/api/v1/rules

# OAuth 2.0 Authentication (Production)
curl -H "Authorization: Bearer YOUR_OAUTH_TOKEN" \
     -H "Content-Type: application/json" \
     http://localhost:8003/api/v1/rules
                </div>

                <div class="alert-box alert-warning">
                    <strong>⚠️ REQUIRE_AUTH Integration:</strong> When REQUIRE_AUTH=true in .env, all API endpoints require valid authentication. The agent integrates seamlessly with the authentication system.
                </div>

                <h3>📊 Performance Metrics</h3>
                <table class="parameter-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th>Average Response Time</th>
                            <th>Throughput</th>
                            <th>Success Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Rule Compilation</td>
                            <td>&lt; 2 seconds</td>
                            <td>50 rules/minute</td>
                            <td>99.5%</td>
                        </tr>
                        <tr>
                            <td>Jurisdiction Resolution</td>
                            <td>&lt; 500ms</td>
                            <td>200 requests/minute</td>
                            <td>99.8%</td>
                        </tr>
                        <tr>
                            <td>Overlap Detection</td>
                            <td>&lt; 1 second</td>
                            <td>100 operations/minute</td>
                            <td>99.2%</td>
                        </tr>
                        <tr>
                            <td>Kafka Processing</td>
                            <td>&lt; 100ms</td>
                            <td>1000 messages/minute</td>
                            <td>99.9%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rule Engine Tab -->
        <div id="rules" class="tab-content">
            <div class="section">
                <h2><span class="icon">⚖️</span>Rule Engine API</h2>
                
                <!-- Compile Rule -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/rules/compile</span>
                    </div>
                    <div class="endpoint-description">
                        Compile a regulatory obligation into executable JSON-Logic rules with condition-action mappings.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>obligation_id</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Unique identifier of the regulatory obligation</td>
                            </tr>
                            <tr>
                                <td>obligation_text</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Full text of the regulatory obligation</td>
                            </tr>
                            <tr>
                                <td>jurisdiction</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Applicable jurisdiction (EU, DE, IE, FR, etc.)</td>
                            </tr>
                            <tr>
                                <td>authority</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Regulatory authority (EBA, BaFin, CBI, etc.)</td>
                            </tr>
                            <tr>
                                <td>regulation</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Source regulation or directive</td>
                            </tr>
                            <tr>
                                <td>priority</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Priority level: LOW, MEDIUM, HIGH, CRITICAL</td>
                            </tr>
                            <tr>
                                <td>effective_date</td>
                                <td><span class="type-badge">date</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>When the obligation becomes effective</td>
                            </tr>
                            <tr>
                                <td>ai_enhanced</td>
                                <td><span class="type-badge">boolean</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Use AI for enhanced rule generation (default: true)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
curl -X POST http://localhost:8003/api/v1/rules/compile \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "obligation_id": "eba_gl_2024_01_001",
    "obligation_text": "Credit institutions shall maintain a capital adequacy ratio of at least 8% for all exposures exceeding EUR 1 million to corporate entities.",
    "jurisdiction": "EU",
    "authority": "EBA",
    "regulation": "CRR Article 92",
    "priority": "HIGH",
    "effective_date": "2024-07-01",
    "ai_enhanced": true
  }'
                    </div>

                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "rule_id": "rule_eba_gl_2024_01_001",
  "compilation_status": "success",
  "processing_time": 1.45,
  "json_logic": {
    "if": [
      {
        "and": [
          {"==": [{"var": "entity_type"}, "credit_institution"]},
          {">=": [{"var": "exposure_amount"}, 1000000]},
          {"==": [{"var": "counterparty_type"}, "corporate"]}
        ]
      },
      {
        "and": [
          {">=": [{"var": "capital_adequacy_ratio"}, 0.08]},
          {"action": "validate_capital_requirement"},
          {"alert": "capital_adequacy_check_required"}
        ]
      },
      {"action": "no_action_required"}
    ]
  },
  "rule_metadata": {
    "conditions_identified": 3,
    "actions_mapped": 2,
    "complexity_score": 0.7,
    "confidence_score": 0.94,
    "variables_extracted": [
      "entity_type",
      "exposure_amount", 
      "counterparty_type",
      "capital_adequacy_ratio"
    ]
  },
  "validation_results": {
    "syntax_valid": true,
    "logic_consistent": true,
    "performance_optimized": true,
    "test_cases_passed": 12
  },
  "ai_insights": {
    "complexity_analysis": "Medium complexity rule with clear conditions",
    "potential_edge_cases": [
      "Multi-currency exposure calculations",
      "Group entity consolidation requirements"
    ],
    "optimization_suggestions": [
      "Consider caching capital ratio calculations",
      "Add validation for exposure currency"
    ]
  }
}
                        </div>
                    </div>
                </div>

                <!-- Get Compiled Rules -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <span class="endpoint-url">/api/v1/rules</span>
                    </div>
                    <div class="endpoint-description">
                        Retrieve compiled rules with filtering and search capabilities.
                    </div>
                    
                    <h4>Query Parameters</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>jurisdiction</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Filter by jurisdiction</td>
                            </tr>
                            <tr>
                                <td>authority</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Filter by regulatory authority</td>
                            </tr>
                            <tr>
                                <td>status</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Filter by rule status: active, inactive, draft</td>
                            </tr>
                            <tr>
                                <td>priority</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Filter by priority level</td>
                            </tr>
                            <tr>
                                <td>effective_from</td>
                                <td><span class="type-badge">date</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Rules effective from this date</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Test Rule -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/rules/{rule_id}/test</span>
                    </div>
                    <div class="endpoint-description">
                        Test a compiled rule with sample data to validate its logic and performance.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>test_data</td>
                                <td><span class="type-badge">object</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Sample data to test the rule against</td>
                            </tr>
                            <tr>
                                <td>test_scenarios</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Multiple test scenarios to validate</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="json-logic-example">
                        <h4>JSON-Logic Rule Example</h4>
                        <pre>{
  "if": [
    {
      "and": [
        {">=": [{"var": "transaction_amount"}, 10000]},
        {"==": [{"var": "customer_risk_level"}, "high"]},
        {"in": [{"var": "jurisdiction"}, ["EU", "DE", "FR"]]}
      ]
    },
    {
      "actions": [
        "enhanced_due_diligence",
        "senior_approval_required",
        "transaction_monitoring"
      ]
    },
    {"action": "standard_processing"}
  ]
}</pre>
                    </div>
                </div>

                <!-- Update Rule -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-put">PUT</span>
                        <span class="endpoint-url">/api/v1/rules/{rule_id}</span>
                    </div>
                    <div class="endpoint-description">
                        Update an existing compiled rule. Changes are versioned and can be rolled back.
                    </div>
                    
                    <div class="alert-box alert-warning">
                        <strong>⚠️ Rule Versioning:</strong> All rule updates create new versions. Previous versions remain available for rollback and audit purposes.
                    </div>
                </div>
            </div>
        </div>

        <!-- Jurisdictions Tab -->
        <div id="jurisdictions" class="tab-content">
            <div class="section">
                <h2><span class="icon">🌍</span>Jurisdiction Management API</h2>
                
                <!-- Get Jurisdiction Hierarchy -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <span class="endpoint-url">/api/v1/jurisdictions/hierarchy</span>
                    </div>
                    <div class="endpoint-description">
                        Retrieve the complete jurisdiction hierarchy with precedence rules and conflict resolution logic.
                    </div>
                    
                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jurisdiction_hierarchy": {
    "EU": {
      "level": 1,
      "precedence": "highest",
      "children": ["DE", "IE", "FR", "NL", "IT", "ES"],
      "regulatory_authorities": ["EBA", "ESMA", "ECB", "EIOPA"],
      "override_rules": {
        "national_implementation": "allowed_with_stricter_requirements",
        "conflict_resolution": "eu_law_prevails"
      }
    },
    "DE": {
      "level": 2,
      "precedence": "national",
      "parent": "EU",
      "regulatory_authorities": ["BaFin", "Bundesbank"],
      "specific_requirements": [
        "German Banking Act (KWG)",
        "BaFin MaRisk Requirements"
      ]
    },
    "IE": {
      "level": 2,
      "precedence": "national", 
      "parent": "EU",
      "regulatory_authorities": ["CBI"],
      "specific_requirements": [
        "Central Bank of Ireland Rules",
        "Consumer Protection Code"
      ]
    }
  },
  "precedence_rules": [
    {
      "rule": "EU law supersedes national law in case of direct conflict",
      "exceptions": ["national_implementation_allowed", "stricter_national_requirements"]
    },
    {
      "rule": "Most restrictive requirement applies when multiple jurisdictions overlap",
      "implementation": "automatic_selection"
    }
  ]
}
                        </div>
                    </div>
                </div>

                <!-- Resolve Jurisdiction Conflicts -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/jurisdictions/resolve-conflicts</span>
                    </div>
                    <div class="endpoint-description">
                        Resolve conflicts between overlapping jurisdictional requirements using intelligent precedence rules.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>conflicting_rules</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Array of conflicting regulatory rules</td>
                            </tr>
                            <tr>
                                <td>entity_jurisdictions</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Jurisdictions applicable to the entity</td>
                            </tr>
                            <tr>
                                <td>resolution_strategy</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Strategy: most_restrictive, precedence_based, custom</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
curl -X POST http://localhost:8003/api/v1/jurisdictions/resolve-conflicts \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "conflicting_rules": [
      {
        "rule_id": "eu_capital_requirement",
        "jurisdiction": "EU",
        "requirement": "minimum_8_percent_capital_ratio",
        "authority": "EBA"
      },
      {
        "rule_id": "de_capital_requirement", 
        "jurisdiction": "DE",
        "requirement": "minimum_10_percent_capital_ratio",
        "authority": "BaFin"
      }
    ],
    "entity_jurisdictions": ["EU", "DE"],
    "resolution_strategy": "most_restrictive"
  }'
                    </div>

                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "resolution_result": {
    "status": "resolved",
    "applied_rule": {
      "rule_id": "de_capital_requirement",
      "jurisdiction": "DE", 
      "requirement": "minimum_10_percent_capital_ratio",
      "authority": "BaFin"
    },
    "resolution_reason": "German national requirement is more restrictive than EU minimum",
    "precedence_analysis": {
      "eu_rule_precedence": 1,
      "de_rule_precedence": 2,
      "resolution_basis": "most_restrictive_requirement",
      "legal_basis": "National implementation allowed under EU directive with stricter requirements"
    },
    "alternative_interpretations": [],
    "compliance_actions": [
      "Apply 10% minimum capital ratio",
      "Report to both EBA and BaFin",
      "Monitor for future regulatory changes"
    ]
  }
}
                        </div>
                    </div>
                </div>

                <!-- Get Applicable Rules -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/jurisdictions/applicable-rules</span>
                    </div>
                    <div class="endpoint-description">
                        Determine which regulatory rules apply to a specific entity based on its jurisdictional footprint.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>entity_type</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Type of entity: bank, payment_institution, investment_firm</td>
                            </tr>
                            <tr>
                                <td>operating_jurisdictions</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Jurisdictions where entity operates</td>
                            </tr>
                            <tr>
                                <td>services_offered</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Financial services offered by the entity</td>
                            </tr>
                            <tr>
                                <td>customer_types</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Types of customers served</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Overlap Resolution Tab -->
        <div id="overlaps" class="tab-content">
            <div class="section">
                <h2><span class="icon">🔄</span>Regulatory Overlap Resolution API</h2>
                
                <!-- Detect Overlaps -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/overlaps/detect</span>
                    </div>
                    <div class="endpoint-description">
                        Detect overlapping regulatory requirements using AI-powered semantic analysis and rule comparison.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>rule_set</td>
                                <td><span class="type-badge">array</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Set of rules to analyze for overlaps</td>
                            </tr>
                            <tr>
                                <td>similarity_threshold</td>
                                <td><span class="type-badge">float</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Minimum similarity score for overlap detection (0.0-1.0)</td>
                            </tr>
                            <tr>
                                <td>semantic_analysis</td>
                                <td><span class="type-badge">boolean</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Enable AI-powered semantic analysis (default: true)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "overlap_analysis": {
    "total_rules_analyzed": 25,
    "overlaps_detected": 3,
    "processing_time": 2.34,
    "overlapping_groups": [
      {
        "group_id": "overlap_group_001",
        "similarity_score": 0.89,
        "overlapping_rules": [
          {
            "rule_id": "eba_capital_req_001",
            "jurisdiction": "EU",
            "authority": "EBA",
            "text": "Credit institutions shall maintain minimum capital ratio of 8%"
          },
          {
            "rule_id": "bafin_capital_req_002", 
            "jurisdiction": "DE",
            "authority": "BaFin",
            "text": "German banks must hold capital adequacy ratio not less than 8%"
          }
        ],
        "overlap_type": "semantic_duplicate",
        "confidence_score": 0.94,
        "recommended_action": "coalesce_rules"
      }
    ],
    "semantic_insights": {
      "common_concepts": [
        "capital adequacy",
        "minimum requirements", 
        "credit institutions"
      ],
      "linguistic_variations": [
        "capital ratio vs capital adequacy ratio",
        "maintain vs hold vs must have"
      ]
    }
  }
}
                        </div>
                    </div>
                </div>

                <!-- Coalesce Rules -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/overlaps/coalesce</span>
                    </div>
                    <div class="endpoint-description">
                        Intelligently combine overlapping regulatory rules into unified, non-redundant requirements.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>overlap_group_id</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>ID of the overlap group to coalesce</td>
                            </tr>
                            <tr>
                                <td>coalescing_strategy</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Strategy: merge, most_restrictive, precedence_based</td>
                            </tr>
                            <tr>
                                <td>preserve_source_references</td>
                                <td><span class="type-badge">boolean</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Keep references to original rules (default: true)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "coalesced_rule": {
    "rule_id": "coalesced_capital_req_001",
    "title": "EU/German Capital Adequacy Requirements",
    "unified_text": "Credit institutions operating in EU/German jurisdiction shall maintain a minimum capital adequacy ratio of 8% as required by EBA guidelines and BaFin regulations",
    "json_logic": {
      "if": [
        {
          "and": [
            {"==": [{"var": "entity_type"}, "credit_institution"]},
            {"in": [{"var": "jurisdiction"}, ["EU", "DE"]]}
          ]
        },
        {
          ">=": [{"var": "capital_adequacy_ratio"}, 0.08]
        },
        {"action": "no_capital_requirement"}
      ]
    },
    "source_rules": [
      {
        "rule_id": "eba_capital_req_001",
        "authority": "EBA",
        "jurisdiction": "EU",
        "contribution": "base_requirement"
      },
      {
        "rule_id": "bafin_capital_req_002",
        "authority": "BaFin", 
        "jurisdiction": "DE",
        "contribution": "national_implementation"
      }
    ],
    "coalescing_metadata": {
      "strategy_used": "most_restrictive",
      "conflicts_resolved": 0,
      "redundancies_eliminated": 2,
      "confidence_score": 0.96
    }
  }
}
                        </div>
                    </div>
                </div>

                <!-- Validate Consistency -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/overlaps/validate-consistency</span>
                    </div>
                    <div class="endpoint-description">
                        Validate the consistency of coalesced rules and detect potential logical conflicts or gaps.
                    </div>
                </div>
            </div>
        </div>

        <!-- Kafka Integration Tab -->
        <div id="kafka" class="tab-content">
            <div class="section">
                <h2><span class="icon">📨</span>Kafka Integration API</h2>
                
                <!-- Consumer Status -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <span class="endpoint-url">/api/v1/kafka/consumer/status</span>
                    </div>
                    <div class="endpoint-description">
                        Get the status of Kafka consumers including lag, throughput, and error rates.
                    </div>
                    
                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "consumer_status": {
    "regulatory_updates_consumer": {
      "status": "running",
      "topic": "regulatory.updates",
      "partition_assignments": [0, 1, 2],
      "current_lag": 15,
      "messages_processed_per_minute": 45,
      "last_processed_offset": 12456,
      "error_count_last_hour": 0
    },
    "dlq_consumer": {
      "status": "running", 
      "topic": "regulatory.dlq",
      "partition_assignments": [0],
      "current_lag": 2,
      "messages_processed_per_minute": 1,
      "last_processed_offset": 89,
      "error_count_last_hour": 0
    }
  },
  "overall_health": "healthy",
  "total_lag": 17,
  "processing_rate": "46 messages/minute"
}
                        </div>
                    </div>
                </div>

                <!-- Producer Metrics -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <span class="endpoint-url">/api/v1/kafka/producer/metrics</span>
                    </div>
                    <div class="endpoint-description">
                        Get Kafka producer metrics including message throughput, success rates, and error statistics.
                    </div>
                </div>

                <!-- Dead Letter Queue Management -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <span class="endpoint-url">/api/v1/kafka/dlq/messages</span>
                    </div>
                    <div class="endpoint-description">
                        Retrieve messages from the Dead Letter Queue for analysis and potential reprocessing.
                    </div>
                    
                    <h4>Query Parameters</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>limit</td>
                                <td><span class="type-badge">integer</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Maximum number of messages to retrieve</td>
                            </tr>
                            <tr>
                                <td>error_type</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Filter by error type</td>
                            </tr>
                            <tr>
                                <td>from_timestamp</td>
                                <td><span class="type-badge">datetime</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Messages from this timestamp</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Reprocess DLQ Message -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/kafka/dlq/{message_id}/reprocess</span>
                    </div>
                    <div class="endpoint-description">
                        Reprocess a specific message from the Dead Letter Queue after fixing the underlying issue.
                    </div>
                    
                    <div class="alert-box alert-warning">
                        <strong>⚠️ DLQ Reprocessing:</strong> Ensure the underlying issue causing the message to fail has been resolved before reprocessing.
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Processing Tab -->
        <div id="ai" class="tab-content">
            <div class="section">
                <h2><span class="icon">🤖</span>AI Processing API</h2>
                
                <!-- Semantic Analysis -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/ai/semantic-analysis</span>
                    </div>
                    <div class="endpoint-description">
                        Perform semantic analysis on regulatory text using advanced NLP models to extract meaning and relationships.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>text</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Regulatory text to analyze</td>
                            </tr>
                            <tr>
                                <td>analysis_type</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Type: entities, sentiment, similarity, classification</td>
                            </tr>
                            <tr>
                                <td>language</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Text language (auto-detected if not provided)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="response-example">
                        <h4>Response Example</h4>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "semantic_analysis": {
    "entities": [
      {
        "text": "credit institutions",
        "label": "REGULATED_ENTITY",
        "confidence": 0.98,
        "start": 0,
        "end": 19
      },
      {
        "text": "8%",
        "label": "PERCENTAGE",
        "confidence": 0.95,
        "start": 65,
        "end": 67
      }
    ],
    "key_concepts": [
      "capital adequacy",
      "minimum requirements",
      "regulatory compliance"
    ],
    "sentiment": {
      "polarity": 0.1,
      "subjectivity": 0.3,
      "classification": "neutral_regulatory"
    },
    "complexity_score": 0.7,
    "readability_score": 0.6,
    "regulatory_indicators": [
      "shall maintain",
      "minimum",
      "requirements"
    ]
  }
}
                        </div>
                    </div>
                </div>

                <!-- Text Similarity -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/ai/similarity</span>
                    </div>
                    <div class="endpoint-description">
                        Calculate semantic similarity between regulatory texts to identify potential overlaps or relationships.
                    </div>
                    
                    <h4>Request Body</h4>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>text1</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>First text for comparison</td>
                            </tr>
                            <tr>
                                <td>text2</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="required-badge">required</span></td>
                                <td>Second text for comparison</td>
                            </tr>
                            <tr>
                                <td>similarity_method</td>
                                <td><span class="type-badge">string</span></td>
                                <td><span class="optional-badge">optional</span></td>
                                <td>Method: cosine, jaccard, semantic (default: semantic)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- LangChain Integration -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <span class="endpoint-url">/api/v1/ai/langchain/reason</span>
                    </div>
                    <div class="endpoint-description">
                        Use LangChain for complex regulatory reasoning and multi-step analysis tasks.
                    </div>
                    
                    <div class="alert-box alert-success">
                        <strong>🤖 AI Integration:</strong> The agent leverages LangChain, OpenAI GPT, and SpaCy for advanced regulatory text processing and reasoning capabilities.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="back-to-top" onclick="scrollToTop()" title="Back to Top">↑</button>

    <script>
        // Tab functionality
        function showTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });

            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Copy to clipboard functionality
        function copyToClipboard(button) {
            const codeBlock = button.nextElementSibling || button.parentElement.querySelector('pre') || button.parentElement;
            const text = codeBlock.textContent.replace('Copy', '').trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = '#27ae60';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#8e44ad';
                }, 2000);
            });
        }

        // Back to top functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show/hide back to top button
        window.addEventListener('scroll', function() {
            const backToTop = document.querySelector('.back-to-top');
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        });

        // Set last updated date
        document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString();

        // Add interactive features
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.endpoint-card, .feature-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px)';
                    this.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
                });
            });
        });
    </script>
</body>
</html>
