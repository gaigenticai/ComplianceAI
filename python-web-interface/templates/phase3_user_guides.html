<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 User Guides - Intelligence & Compliance Agent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/design-system.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .guide-header {
            background: var(--primary-gradient);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .guide-nav {
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            min-height: calc(100vh - 200px);
            padding: 2rem 1rem;
        }

        .guide-content {
            padding: 2rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .guide-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .guide-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-link {
            color: #495057;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            background: none;
            text-align: left;
            width: 100%;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateX(5px);
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 4px solid #667eea;
        }

        .code-block {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .step-number {
            background: var(--primary-gradient);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }

        .alert-tip {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            color: #0d47a1;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%);
            border-left: 4px solid #ff9800;
            color: #e65100;
        }

        .search-box {
            position: sticky;
            top: 0;
            background: white;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
            z-index: 100;
        }

        .highlight {
            background: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .toc {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            padding: 0.25rem 0;
        }

        .toc a {
            color: #495057;
            text-decoration: none;
        }

        .toc a:hover {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="guide-header">
        <div class="container">
            <h1><i class="fas fa-book me-3"></i>Phase 3 User Guides</h1>
            <p class="lead">Comprehensive documentation for Intelligence & Compliance Agent features</p>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Navigation Sidebar -->
            <div class="col-md-3 guide-nav">
                <div class="search-box">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search guides...">
                </div>
                
                <h5 class="mb-3">Navigation</h5>
                <nav class="nav flex-column">
                    <button class="nav-link active" data-section="overview">
                        <i class="fas fa-home me-2"></i>Overview
                    </button>
                    <button class="nav-link" data-section="rule-compiler">
                        <i class="fas fa-code me-2"></i>Rule Compiler
                    </button>
                    <button class="nav-link" data-section="kafka-consumer">
                        <i class="fas fa-stream me-2"></i>Kafka Consumer
                    </button>
                    <button class="nav-link" data-section="jurisdiction-handler">
                        <i class="fas fa-globe me-2"></i>Jurisdiction Handler
                    </button>
                    <button class="nav-link" data-section="overlap-resolver">
                        <i class="fas fa-layer-group me-2"></i>Overlap Resolver
                    </button>
                    <button class="nav-link" data-section="audit-logger">
                        <i class="fas fa-clipboard-list me-2"></i>Audit Logger
                    </button>
                    <button class="nav-link" data-section="api-reference">
                        <i class="fas fa-code-branch me-2"></i>API Reference
                    </button>
                    <button class="nav-link" data-section="troubleshooting">
                        <i class="fas fa-tools me-2"></i>Troubleshooting
                    </button>
                </nav>
            </div>

            <!-- Content Area -->
            <div class="col-md-9 guide-content">
                <!-- Overview Section -->
                <div class="guide-section active" id="overview">
                    <h2><i class="fas fa-home me-3"></i>Phase 3 Overview</h2>
                    
                    <div class="toc">
                        <h5>Table of Contents</h5>
                        <ul>
                            <li><a href="#what-is-phase3">What is Phase 3?</a></li>
                            <li><a href="#key-features">Key Features</a></li>
                            <li><a href="#architecture">Architecture</a></li>
                            <li><a href="#getting-started">Getting Started</a></li>
                        </ul>
                    </div>

                    <div class="feature-card" id="what-is-phase3">
                        <h3>What is Phase 3?</h3>
                        <p>Phase 3 enhances the Intelligence & Compliance Agent with advanced regulatory rule processing capabilities. It introduces five core components that work together to provide comprehensive compliance automation:</p>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i><strong>Rule Compiler:</strong> Converts regulatory text to JSON-Logic</li>
                                    <li><i class="fas fa-check text-success me-2"></i><strong>Kafka Consumer:</strong> Real-time regulatory updates</li>
                                    <li><i class="fas fa-check text-success me-2"></i><strong>Jurisdiction Handler:</strong> Country-specific rule filtering</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i><strong>Overlap Resolver:</strong> Eliminates conflicting rules</li>
                                    <li><i class="fas fa-check text-success me-2"></i><strong>Audit Logger:</strong> Comprehensive compliance trail</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card" id="key-features">
                        <h3>Key Features</h3>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center mb-3">
                                    <i class="fas fa-brain fa-3x text-primary mb-2"></i>
                                    <h5>AI-Powered Processing</h5>
                                    <p>Uses GPT-4 and advanced NLP to understand regulatory text</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center mb-3">
                                    <i class="fas fa-shield-alt fa-3x text-success mb-2"></i>
                                    <h5>Audit Trail</h5>
                                    <p>Immutable audit logs with cryptographic integrity</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center mb-3">
                                    <i class="fas fa-globe fa-3x text-info mb-2"></i>
                                    <h5>Multi-Jurisdiction</h5>
                                    <p>Supports EU, DE, IE, GB regulatory frameworks</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card" id="architecture">
                        <h3>Architecture</h3>
                        <p>Phase 3 follows a microservices architecture with clear separation of concerns:</p>
                        
                        <div class="code-block">
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Rule Compiler │    │ Kafka Consumer  │    │Jurisdiction     │
│                 │    │                 │    │Handler          │
│ • Parse regs    │    │ • Real-time     │    │                 │
│ • Extract logic │    │   updates       │    │ • Filter rules  │
│ • Generate JSON │    │ • Auto-refresh  │    │ • Resolve       │
│                 │    │                 │    │   conflicts     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────┐    ┌─────────────────┐
         │ Overlap Resolver│    │  Audit Logger   │
         │                 │    │                 │
         │ • Detect        │    │ • Immutable     │
         │   overlaps      │    │   records       │
         │ • Merge rules   │    │ • HMAC integrity│
         │ • NLP analysis  │    │ • Export trails │
         └─────────────────┘    └─────────────────┘
                        </div>
                    </div>

                    <div class="feature-card" id="getting-started">
                        <h3>Getting Started</h3>
                        <p>Follow these steps to start using Phase 3 features:</p>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">1</span>
                            <div>
                                <h6>Access the Dashboard</h6>
                                <p>Navigate to <code>/phase3</code> to access the Phase 3 dashboard</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">2</span>
                            <div>
                                <h6>Test Rule Compilation</h6>
                                <p>Use the Rule Compiler tab to convert regulatory text into executable rules</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">3</span>
                            <div>
                                <h6>Monitor Real-time Updates</h6>
                                <p>Check the Kafka Consumer tab for live regulatory updates</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start">
                            <span class="step-number">4</span>
                            <div>
                                <h6>Review Audit Trails</h6>
                                <p>Use the Audit Logger tab to track all system activities</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rule Compiler Section -->
                <div class="guide-section" id="rule-compiler">
                    <h2><i class="fas fa-code me-3"></i>Rule Compiler</h2>
                    
                    <div class="feature-card">
                        <h3>Overview</h3>
                        <p>The Rule Compiler converts human-readable regulatory obligations into executable JSON-Logic rules. It uses advanced AI and NLP to understand regulatory text and extract actionable requirements.</p>
                        
                        <div class="alert alert-tip">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Tip:</strong> The Rule Compiler supports all major regulatory frameworks including AML, KYC, GDPR, Basel III, PSD2, and DORA.
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>How to Use</h3>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">1</span>
                            <div>
                                <h6>Enter Regulatory Text</h6>
                                <p>Paste the regulatory obligation text in the text area. For example:</p>
                                <div class="code-block">
Customer due diligence must be performed for transactions exceeding EUR 15,000 or when the customer is a politically exposed person.
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">2</span>
                            <div>
                                <h6>Select Regulation Type</h6>
                                <p>Choose the appropriate regulation type from the dropdown (AML, KYC, GDPR, etc.)</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">3</span>
                            <div>
                                <h6>Choose Jurisdiction</h6>
                                <p>Select the applicable jurisdiction (EU, DE, IE, GB)</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start">
                            <span class="step-number">4</span>
                            <div>
                                <h6>Compile and Validate</h6>
                                <p>Click "Compile Rule" to generate JSON-Logic, then use "Validate Rule" and "Test Rule" buttons</p>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>JSON-Logic Output</h3>
                        <p>The compiler generates standard JSON-Logic rules that can be executed by any JSON-Logic engine:</p>
                        
                        <div class="code-block">
{
  "and": [
    {
      "or": [
        {">": [{"var": "transaction.amount"}, 15000]},
        {"==": [{"var": "customer.is_pep"}, true]}
      ]
    },
    {"==": [{"var": "customer.verification_status"}, "verified"]}
  ]
}
                        </div>
                    </div>
                </div>

                <!-- Kafka Consumer Section -->
                <div class="guide-section" id="kafka-consumer">
                    <h2><i class="fas fa-stream me-3"></i>Kafka Consumer</h2>
                    
                    <div class="feature-card">
                        <h3>Overview</h3>
                        <p>The Kafka Consumer monitors the <code>regulatory.updates</code> topic for real-time regulatory changes and automatically triggers rule recompilation when needed.</p>
                        
                        <div class="alert alert-tip">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Note:</strong> The consumer runs continuously in the background and provides real-time updates via WebSocket connections.
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Consumer Status</h3>
                        <p>Monitor the consumer status through the dashboard:</p>
                        
                        <ul>
                            <li><strong>Active:</strong> Consumer is running and processing messages</li>
                            <li><strong>Inactive:</strong> Consumer is stopped</li>
                            <li><strong>Error:</strong> Consumer encountered an error</li>
                        </ul>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Important:</strong> If the consumer shows high lag, it may indicate performance issues or message processing delays.
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Event Types</h3>
                        <p>The consumer handles these event types:</p>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6>obligation_created</h6>
                                <p>New regulatory obligation added</p>
                                
                                <h6>obligation_updated</h6>
                                <p>Existing obligation modified</p>
                            </div>
                            <div class="col-md-6">
                                <h6>obligation_deleted</h6>
                                <p>Obligation removed or expired</p>
                                
                                <h6>system_status</h6>
                                <p>System-wide status updates</p>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Testing Messages</h3>
                        <p>Use the test message feature to simulate regulatory updates:</p>
                        
                        <div class="code-block">
{
  "obligation_id": "test_001",
  "regulation_type": "AML",
  "jurisdiction": "EU",
  "change_type": "updated",
  "effective_date": "2024-01-01"
}
                        </div>
                    </div>
                </div>

                <!-- Jurisdiction Handler Section -->
                <div class="guide-section" id="jurisdiction-handler">
                    <h2><i class="fas fa-globe me-3"></i>Jurisdiction Handler</h2>
                    
                    <div class="feature-card">
                        <h3>Overview</h3>
                        <p>The Jurisdiction Handler filters and applies rules based on geographic and regulatory scope. It handles multi-jurisdiction scenarios and resolves conflicts between different regulatory frameworks.</p>
                    </div>

                    <div class="feature-card">
                        <h3>Supported Jurisdictions</h3>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <i class="fas fa-flag fa-2x text-primary mb-2"></i>
                                    <h6>EU</h6>
                                    <p>European Union<br>Supranational Level</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <i class="fas fa-flag fa-2x text-warning mb-2"></i>
                                    <h6>DE</h6>
                                    <p>Germany<br>National Level</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <i class="fas fa-flag fa-2x text-success mb-2"></i>
                                    <h6>IE</h6>
                                    <p>Ireland<br>National Level</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <i class="fas fa-flag fa-2x text-info mb-2"></i>
                                    <h6>GB</h6>
                                    <p>United Kingdom<br>National Level</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Conflict Resolution Strategies</h3>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">1</span>
                            <div>
                                <h6>Most Restrictive</h6>
                                <p>Applies the most restrictive rule when conflicts arise</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">2</span>
                            <div>
                                <h6>Customer Preference</h6>
                                <p>Uses the customer's primary jurisdiction rules</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">3</span>
                            <div>
                                <h6>Business Preference</h6>
                                <p>Applies the business's jurisdiction rules</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start">
                            <span class="step-number">4</span>
                            <div>
                                <h6>Hierarchical</h6>
                                <p>Follows regulatory hierarchy (EU > National > Local)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overlap Resolver Section -->
                <div class="guide-section" id="overlap-resolver">
                    <h2><i class="fas fa-layer-group me-3"></i>Overlap Resolver</h2>
                    
                    <div class="feature-card">
                        <h3>Overview</h3>
                        <p>The Overlap Resolver identifies and consolidates overlapping regulatory obligations using advanced NLP techniques. It prevents redundant compliance checks and resolves conflicting requirements.</p>
                    </div>

                    <div class="feature-card">
                        <h3>Detection Methods</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-brain me-2"></i>Semantic Analysis</h6>
                                <p>Uses SpaCy and word embeddings to understand meaning</p>
                                
                                <h6><i class="fas fa-chart-line me-2"></i>TF-IDF Similarity</h6>
                                <p>Calculates text similarity using term frequency analysis</p>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-tags me-2"></i>Keyword Matching</h6>
                                <p>Identifies common regulatory keywords and phrases</p>
                                
                                <h6><i class="fas fa-layer-group me-2"></i>Structural Analysis</h6>
                                <p>Compares rule structure and logical patterns</p>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Similarity Thresholds</h3>
                        <p>Configure similarity thresholds for different overlap types:</p>
                        
                        <div class="code-block">
# High similarity (90%+): Likely duplicates
# Medium similarity (70-89%): Potential overlaps  
# Low similarity (50-69%): Related but distinct
# No overlap (<50%): Independent rules
                        </div>
                        
                        <div class="alert alert-tip">
                            <i class="fas fa-sliders-h me-2"></i>
                            <strong>Tip:</strong> Adjust the similarity threshold based on your organization's risk tolerance and compliance requirements.
                        </div>
                    </div>
                </div>

                <!-- Audit Logger Section -->
                <div class="guide-section" id="audit-logger">
                    <h2><i class="fas fa-clipboard-list me-3"></i>Audit Logger</h2>
                    
                    <div class="feature-card">
                        <h3>Overview</h3>
                        <p>The Audit Logger provides comprehensive audit trail capabilities with cryptographic integrity verification. All system activities are logged with immutable records and HMAC-SHA256 tamper detection.</p>
                        
                        <div class="alert alert-tip">
                            <i class="fas fa-shield-alt me-2"></i>
                            <strong>Security:</strong> All audit entries are cryptographically signed and cannot be modified after creation.
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Audit Entry Types</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-code text-primary me-2"></i><strong>rule_compiled:</strong> Rule compilation events</li>
                                    <li><i class="fas fa-edit text-warning me-2"></i><strong>rule_updated:</strong> Rule modification events</li>
                                    <li><i class="fas fa-trash text-danger me-2"></i><strong>rule_deleted:</strong> Rule deletion events</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-globe text-info me-2"></i><strong>jurisdiction_changed:</strong> Jurisdiction updates</li>
                                    <li><i class="fas fa-layer-group text-success me-2"></i><strong>overlap_resolved:</strong> Overlap resolution</li>
                                    <li><i class="fas fa-cog text-secondary me-2"></i><strong>system_event:</strong> System-level events</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Export Formats</h3>
                        <p>Export audit trails in multiple formats:</p>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-file-code fa-2x text-primary mb-2"></i>
                                    <h6>JSON</h6>
                                    <p>Machine-readable format for integration</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-file-csv fa-2x text-success mb-2"></i>
                                    <h6>CSV</h6>
                                    <p>Spreadsheet-compatible format</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-file-alt fa-2x text-warning mb-2"></i>
                                    <h6>XML</h6>
                                    <p>Structured format for compliance systems</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Integrity Verification</h3>
                        <p>Verify audit trail integrity using cryptographic signatures:</p>
                        
                        <div class="code-block">
# Each audit entry includes:
{
  "entry_id": "audit_12345",
  "timestamp": "2024-01-15T10:30:00Z",
  "action": "rule_compiled",
  "details": "AML rule compiled for EU jurisdiction",
  "user_id": "system_user",
  "hmac_signature": "a1b2c3d4e5f6...",
  "integrity_verified": true
}
                        </div>
                    </div>
                </div>

                <!-- API Reference Section -->
                <div class="guide-section" id="api-reference">
                    <h2><i class="fas fa-code-branch me-3"></i>API Reference</h2>
                    
                    <div class="feature-card">
                        <h3>Base URL</h3>
                        <div class="code-block">
https://your-domain.com/api/phase3
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Authentication</h3>
                        <p>API authentication is controlled by the <code>REQUIRE_AUTH</code> environment variable:</p>
                        
                        <div class="code-block">
# When REQUIRE_AUTH=false (default)
# No authentication required for testing

# When REQUIRE_AUTH=true  
# JWT token required in Authorization header
Authorization: Bearer your-jwt-token
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Rule Compiler Endpoints</h3>
                        
                        <h6>POST /rule-compiler/compile</h6>
                        <p>Compile regulatory obligation into JSON-Logic rule</p>
                        
                        <div class="code-block">
{
  "obligation_text": "Customer due diligence required for amounts > EUR 15,000",
  "regulation_type": "AML",
  "jurisdiction": "EU"
}
                        </div>
                        
                        <h6>POST /rule-compiler/validate</h6>
                        <p>Validate JSON-Logic rule structure</p>
                        
                        <div class="code-block">
{
  "json_logic": {
    ">": [{"var": "transaction.amount"}, 15000]
  }
}
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Kafka Consumer Endpoints</h3>
                        
                        <h6>POST /kafka-consumer/start</h6>
                        <p>Start the Kafka consumer</p>
                        
                        <h6>POST /kafka-consumer/stop</h6>
                        <p>Stop the Kafka consumer</p>
                        
                        <h6>POST /kafka-consumer/test-message</h6>
                        <p>Send test message to consumer</p>
                        
                        <div class="code-block">
{
  "event_type": "obligation_created",
  "payload": {
    "obligation_id": "test_001",
    "regulation_type": "AML",
    "jurisdiction": "EU"
  }
}
                        </div>
                    </div>
                </div>

                <!-- Troubleshooting Section -->
                <div class="guide-section" id="troubleshooting">
                    <h2><i class="fas fa-tools me-3"></i>Troubleshooting</h2>
                    
                    <div class="feature-card">
                        <h3>Common Issues</h3>
                        
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Rule Compilation Fails</h6>
                            <p><strong>Symptoms:</strong> Compilation returns error or empty result</p>
                            <p><strong>Solutions:</strong></p>
                            <ul>
                                <li>Check that OpenAI API key is configured</li>
                                <li>Verify regulatory text is in English</li>
                                <li>Ensure text contains actionable requirements</li>
                            </ul>
                        </div>
                        
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-stream me-2"></i>Kafka Consumer Not Receiving Messages</h6>
                            <p><strong>Symptoms:</strong> Consumer shows as active but no messages processed</p>
                            <p><strong>Solutions:</strong></p>
                            <ul>
                                <li>Check Kafka broker connectivity</li>
                                <li>Verify topic exists and has messages</li>
                                <li>Check consumer group configuration</li>
                            </ul>
                        </div>
                        
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-database me-2"></i>Database Connection Issues</h6>
                            <p><strong>Symptoms:</strong> API endpoints return database errors</p>
                            <p><strong>Solutions:</strong></p>
                            <ul>
                                <li>Verify PostgreSQL is running</li>
                                <li>Check database credentials in environment variables</li>
                                <li>Ensure database schema is up to date</li>
                            </ul>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Performance Optimization</h3>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">1</span>
                            <div>
                                <h6>Rule Compilation Performance</h6>
                                <p>Target: <100ms per rule. Optimize by adjusting AI model temperature and token limits.</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start mb-3">
                            <span class="step-number">2</span>
                            <div>
                                <h6>Kafka Consumer Lag</h6>
                                <p>Target: <500ms for rule refresh. Monitor consumer lag and increase parallelism if needed.</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-start">
                            <span class="step-number">3</span>
                            <div>
                                <h6>Database Queries</h6>
                                <p>Use connection pooling and optimize queries with proper indexes.</p>
                            </div>
                        </div>
                    </div>

                    <div class="feature-card">
                        <h3>Monitoring and Alerts</h3>
                        <p>Monitor these key metrics:</p>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Rule compilation success rate</li>
                                    <li>Average compilation time</li>
                                    <li>Kafka consumer lag</li>
                                    <li>Database connection pool usage</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Audit entry creation rate</li>
                                    <li>Overlap detection accuracy</li>
                                    <li>API response times</li>
                                    <li>Error rates by component</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navigation functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.guide-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // Scroll to top of content
                document.querySelector('.guide-content').scrollTop = 0;
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const sections = document.querySelectorAll('.guide-section');
            
            sections.forEach(section => {
                const content = section.textContent.toLowerCase();
                const isVisible = content.includes(searchTerm);
                
                // Find corresponding nav link
                const sectionId = section.id;
                const navLink = document.querySelector(`[data-section="${sectionId}"]`);
                
                if (navLink) {
                    navLink.style.display = isVisible || searchTerm === '' ? 'block' : 'none';
                }
            });
        });

        // Highlight search terms
        function highlightSearchTerm(text, term) {
            if (!term) return text;
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
