<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt me-2"></i>
                KYC Automation Platform
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home me-1"></i>
                    New Request
                </a>
                <a class="nav-link" href="/userguide">
                    <i class="fas fa-book me-1"></i>
                    User Guide
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center py-4">
                        <h1 class="display-5 fw-bold text-primary mb-2">KYC Verification Results</h1>
                        <p class="text-muted mb-0">Request ID: <code>{{ request_id }}</code></p>
                        <small class="text-muted">Processed on {{ result.timestamp }}</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Executive Summary -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            Executive Summary
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Recommendation -->
                            <div class="col-md-3 mb-3">
                                <div class="text-center">
                                    {% if result.executive_summary.recommendation == "Approve" %}
                                        <div class="recommendation-badge bg-success text-white rounded-pill py-2 px-3 mb-2">
                                            <i class="fas fa-check-circle me-1"></i>
                                            APPROVED
                                        </div>
                                    {% elif result.executive_summary.recommendation == "Conditional" %}
                                        <div class="recommendation-badge bg-warning text-dark rounded-pill py-2 px-3 mb-2">
                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                            CONDITIONAL
                                        </div>
                                    {% elif result.executive_summary.recommendation == "Escalate" %}
                                        <div class="recommendation-badge bg-info text-white rounded-pill py-2 px-3 mb-2">
                                            <i class="fas fa-arrow-up me-1"></i>
                                            ESCALATE
                                        </div>
                                    {% else %}
                                        <div class="recommendation-badge bg-danger text-white rounded-pill py-2 px-3 mb-2">
                                            <i class="fas fa-times-circle me-1"></i>
                                            REJECTED
                                        </div>
                                    {% endif %}
                                    <h6 class="text-muted">Final Decision</h6>
                                </div>
                            </div>

                            <!-- Risk Score -->
                            <div class="col-md-3 mb-3">
                                <div class="text-center">
                                    <div class="risk-score-circle mx-auto mb-2" data-score="{{ result.executive_summary.risk_score }}">
                                        <span class="risk-score-text">{{ result.executive_summary.risk_score }}%</span>
                                    </div>
                                    <h6 class="text-muted">Risk Score</h6>
                                </div>
                            </div>

                            <!-- Confidence -->
                            <div class="col-md-3 mb-3">
                                <div class="text-center">
                                    <div class="confidence-bar mb-2">
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-info" role="progressbar" 
                                                 style="width: {{ result.executive_summary.confidence }}%"
                                                 aria-valuenow="{{ result.executive_summary.confidence }}" 
                                                 aria-valuemin="0" aria-valuemax="100">
                                                {{ result.executive_summary.confidence }}%
                                            </div>
                                        </div>
                                    </div>
                                    <h6 class="text-muted">Confidence Level</h6>
                                </div>
                            </div>

                            <!-- Processing Time -->
                            <div class="col-md-3 mb-3">
                                <div class="text-center">
                                    <div class="processing-time mb-2">
                                        <span class="display-6 text-primary">{{ result.executive_summary.processing_time }}ms</span>
                                    </div>
                                    <h6 class="text-muted">Processing Time</h6>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Savings -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="alert alert-success">
                                    <i class="fas fa-dollar-sign me-2"></i>
                                    <strong>Estimated Cost Savings:</strong> ${{ result.executive_summary.cost_savings }}
                                    compared to manual processing
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Analysis -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-microscope me-2"></i>
                            Detailed Analysis
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="analysisAccordion">
                            <!-- OCR Results -->
                            {% if result.detailed_analysis.ocr_results %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#ocrResults" aria-expanded="true">
                                        <i class="fas fa-eye me-2"></i>
                                        Document OCR Analysis
                                    </button>
                                </h2>
                                <div id="ocrResults" class="accordion-collapse collapse show">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded"><code>{{ result.detailed_analysis.ocr_results }}</code></pre>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Biometric Results -->
                            {% if result.detailed_analysis.biometric_results %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#biometricResults">
                                        <i class="fas fa-face-smile me-2"></i>
                                        Biometric Verification
                                    </button>
                                </h2>
                                <div id="biometricResults" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded"><code>{{ result.detailed_analysis.biometric_results }}</code></pre>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Watchlist Results -->
                            {% if result.detailed_analysis.watchlist_results %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#watchlistResults">
                                        <i class="fas fa-list-check me-2"></i>
                                        Watchlist Screening
                                    </button>
                                </h2>
                                <div id="watchlistResults" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded"><code>{{ result.detailed_analysis.watchlist_results }}</code></pre>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Data Integration Results -->
                            {% if result.detailed_analysis.data_integration_results %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#dataIntegrationResults">
                                        <i class="fas fa-database me-2"></i>
                                        Data Integration
                                    </button>
                                </h2>
                                <div id="dataIntegrationResults" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded"><code>{{ result.detailed_analysis.data_integration_results }}</code></pre>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Risk Assessment -->
                            {% if result.detailed_analysis.risk_assessment %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#riskAssessment">
                                        <i class="fas fa-chart-line me-2"></i>
                                        Risk Assessment
                                    </button>
                                </h2>
                                <div id="riskAssessment" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <pre class="bg-light p-3 rounded"><code>{{ result.detailed_analysis.risk_assessment }}</code></pre>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QA Verdict -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0">
                            <i class="fas fa-clipboard-check me-2"></i>
                            Quality Assurance Verdict
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>QA Status</h6>
                                {% if result.qa_verdict.status == "Passed" %}
                                    <span class="badge bg-success fs-6">
                                        <i class="fas fa-check me-1"></i>
                                        {{ result.qa_verdict.status }}
                                    </span>
                                {% elif result.qa_verdict.status == "Warning" %}
                                    <span class="badge bg-warning fs-6">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        {{ result.qa_verdict.status }}
                                    </span>
                                {% elif result.qa_verdict.status == "Failed" %}
                                    <span class="badge bg-danger fs-6">
                                        <i class="fas fa-times me-1"></i>
                                        {{ result.qa_verdict.status }}
                                    </span>
                                {% else %}
                                    <span class="badge bg-info fs-6">
                                        <i class="fas fa-user me-1"></i>
                                        {{ result.qa_verdict.status }}
                                    </span>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <h6>QA Score</h6>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         style="width: {{ result.qa_verdict.qa_score }}%"
                                         aria-valuenow="{{ result.qa_verdict.qa_score }}" 
                                         aria-valuemin="0" aria-valuemax="100">
                                                                                        {{ result.qa_verdict.qa_score }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {% if result.qa_verdict.exceptions %}
                        <div class="mt-3">
                            <h6>Exceptions</h6>
                            <ul class="list-group list-group-flush">
                                {% for exception in result.qa_verdict.exceptions %}
                                <li class="list-group-item">
                                    <i class="fas fa-exclamation-circle text-warning me-2"></i>
                                    {{ exception }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Actionable Insights -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>
                            Actionable Insights
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Follow-up Actions -->
                            <div class="col-md-4 mb-3">
                                <h6 class="text-primary">
                                    <i class="fas fa-tasks me-1"></i>
                                    Follow-up Actions
                                </h6>
                                {% if result.actionable_insights.follow_up_actions %}
                                <ul class="list-unstyled">
                                    {% for action in result.actionable_insights.follow_up_actions %}
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-primary me-2"></i>
                                        {{ action }}
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted">No follow-up actions required</p>
                                {% endif %}
                            </div>

                            <!-- Monitoring Requirements -->
                            <div class="col-md-4 mb-3">
                                <h6 class="text-info">
                                    <i class="fas fa-eye me-1"></i>
                                    Monitoring Requirements
                                </h6>
                                {% if result.actionable_insights.monitoring_requirements %}
                                <ul class="list-unstyled">
                                    {% for requirement in result.actionable_insights.monitoring_requirements %}
                                    <li class="mb-2">
                                        <i class="fas fa-clock text-info me-2"></i>
                                        {{ requirement }}
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted">Standard monitoring applies</p>
                                {% endif %}
                            </div>

                            <!-- Process Improvements -->
                            <div class="col-md-4 mb-3">
                                <h6 class="text-warning">
                                    <i class="fas fa-cog me-1"></i>
                                    Process Improvements
                                </h6>
                                {% if result.actionable_insights.process_improvements %}
                                <ul class="list-unstyled">
                                    {% for improvement in result.actionable_insights.process_improvements %}
                                    <li class="mb-2">
                                        <i class="fas fa-plus text-warning me-2"></i>
                                        {{ improvement }}
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted">No improvements suggested</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Trail -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-history me-2"></i>
                            Audit Trail
                        </h4>
                    </div>
                    <div class="card-body">
                        <!-- Processing Steps -->
                        <h6 class="text-primary mb-3">Processing Steps</h6>
                        <div class="timeline">
                            {% for step in result.audit_trail.processing_steps %}
                            <div class="timeline-item">
                                <div class="timeline-marker bg-primary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">{{ step.step_name }}</h6>
                                    <p class="text-muted mb-1">
                                        <strong>Agent:</strong> {{ step.agent }} | 
                                        <strong>Status:</strong> {{ step.status }}
                                    </p>
                                    <small class="text-muted">
                                        {{ step.start_time | date(format="%H:%M:%S") }} - 
                                        {{ step.end_time | date(format="%H:%M:%S") }}
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Data Sources and Rules -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h6 class="text-info mb-3">Data Sources Accessed</h6>
                                <ul class="list-group list-group-flush">
                                    {% for source in result.audit_trail.data_sources %}
                                    <li class="list-group-item">
                                        <i class="fas fa-database text-info me-2"></i>
                                        {{ source }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success mb-3">Rules Applied</h6>
                                <ul class="list-group list-group-flush">
                                    {% for rule in result.audit_trail.rules_applied %}
                                    <li class="list-group-item">
                                        <i class="fas fa-gavel text-success me-2"></i>
                                        {{ rule }}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-comment me-2"></i>
                            Provide Feedback
                        </h4>
                    </div>
                    <div class="card-body">
                        <form id="feedbackForm">
                            <input type="hidden" name="request_id" value="{{ request_id }}">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="reviewer_id" class="form-label">Reviewer ID</label>
                                    <input type="text" class="form-control" id="reviewer_id" name="reviewer_id" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="feedback_type" class="form-label">Feedback Type</label>
                                    <select class="form-select" id="feedback_type" name="feedback_type" required>
                                        <option value="">Select feedback type</option>
                                        <option value="correction">Correction</option>
                                        <option value="confirmation">Confirmation</option>
                                        <option value="improvement">Improvement Suggestion</option>
                                        <option value="issue">Issue Report</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="feedback_text" class="form-label">Feedback Details</label>
                                <textarea class="form-control" id="feedback_text" name="feedback_text" rows="4" required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="corrections" class="form-label">Corrections (JSON format, optional)</label>
                                <textarea class="form-control" id="corrections" name="corrections" rows="3" placeholder='{"field": "corrected_value"}'></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-1"></i>
                                Submit Feedback
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-primary">KYC Automation Platform</h6>
                    <p class="text-muted small mb-0">
                        Secure, compliant, and efficient customer verification
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">
                        <i class="fas fa-shield-alt me-1"></i>
                        GDPR & PCI-DSS Compliant
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
